<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>HolyShit.app ‚Äî Seek Sanctuary</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üí©</text></svg>">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#EAE6DF">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=Cinzel:wght@400;700&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #EAE6DF; 
            --card-bg: #FDF6E8;
            --border: #E2CEAD;
            --text: #2A1A0A;
            --gold: #B8841E;
            --red: #8B2635;
        }
        
        body, html { margin: 0; padding: 0; height: 100%; font-family: 'Nunito', sans-serif; background: var(--bg-color); overflow: hidden; }

        /* --- THE DIVINE SPLASH PAGE --- */
        #splash {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; 
            background: radial-gradient(circle at center, #FFFDF0 0%, #E2CEAD 100%);
            z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center;
            text-align: center; padding: 20px; box-sizing: border-box; transition: opacity 0.8s ease;
            overflow: hidden;
        }

        .divine-glow {
            position: absolute; width: 300px; height: 300px;
            background: radial-gradient(circle, rgba(255, 215, 0, 0.4) 0%, rgba(255,255,255,0) 70%);
            border-radius: 50%; z-index: 1; animation: pulse-glow 4s infinite alternate;
        }

        @keyframes pulse-glow {
            0% { transform: scale(1); opacity: 0.6; box-shadow: 0 0 50px rgba(255, 215, 0, 0.4); }
            100% { transform: scale(1.6); opacity: 1; box-shadow: 0 0 150px rgba(255, 255, 255, 0.8), 0 0 200px rgba(255, 215, 0, 0.6); }
        }

        .majestic-poo {
            font-size: 7rem; z-index: 2; filter: drop-shadow(0 15px 15px rgba(0,0,0,0.2));
            animation: float 3.5s ease-in-out infinite; margin-bottom: 10px;
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
            100% { transform: translateY(0px); }
        }

        #splash h1 { font-family: 'Cinzel Decorative', cursive; font-size: 4.5rem; color: var(--red); margin: 0; text-shadow: 3px 3px var(--border); z-index: 2; position: relative; }
        #splash p { font-family: 'Cinzel', serif; font-size: 1.2rem; color: var(--gold); margin: 15px 0 40px; font-weight: bold; letter-spacing: 1px; z-index: 2; position: relative; }
        .btn-enter { position: relative; z-index: 2; background: var(--red); color: white; border: none; padding: 20px 50px; border-radius: 40px; font-family: 'Cinzel', serif; font-size: 1.3rem; font-weight: bold; cursor: pointer; box-shadow: 0 6px 0 #601a25; transition: all 0.1s; }
        .btn-enter:active { transform: translateY(4px); box-shadow: 0 2px 0 #601a25; }

        /* --- BENTO BOX LAYOUT --- */
        .bento-wrapper {
            display: grid; grid-template-columns: 350px 1fr; gap: 20px; padding: 20px;
            height: 100vh; box-sizing: border-box; max-width: 1600px; margin: 0 auto;
        }
        .bento-card {
            background: var(--card-bg); border-radius: 30px; box-shadow: 0 8px 25px rgba(0,0,0,0.06);
            border: 1px solid var(--border); overflow: hidden; position: relative;
        }

        /* --- THE DASHBOARD --- */
        .sidebar { padding: 30px; display: flex; flex-direction: column; overflow-y: auto; }
        .logo-small { font-family: 'Cinzel Decorative', cursive; font-size: 2.2rem; color: var(--red); margin: 0 0 20px 0; text-shadow: 1px 1px 0px var(--border); cursor: pointer; border-bottom: 2px solid var(--border); padding-bottom: 15px; }
        
        #default-menu p { font-size: 1.05rem; line-height: 1.6; color: var(--text); }
        .gospel-quote { color: var(--gold); font-style: italic; font-family: 'Cinzel', serif; text-align: center; margin-top: 20px; font-size: 1.1rem; }
        
        /* Filters */
        .filter-section { margin-top: 20px; border-top: 1px solid var(--border); padding-top: 15px; }
        .filter-section h3 { font-family: 'Cinzel', serif; color: var(--gold); font-size: 0.9rem; margin-top: 0; text-transform: uppercase; letter-spacing: 1px; }
        .filter-grid { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px; }
        
        .filter-btn { background: white; border: 1px solid var(--border); padding: 8px 12px; border-radius: 20px; font-family: 'Nunito', sans-serif; font-weight: bold; color: var(--text); cursor: pointer; transition: all 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.05); font-size: 0.9rem; }
        .filter-btn:active { transform: scale(0.95); }
        
        /* Active Filter Colors */
        .filter-btn.active-maccas { background: #FFC72C; color: #27251F; border-color: #FFC72C; }
        .filter-btn.active-kfc { background: #E50027; color: white; border-color: #E50027; }
        .filter-btn.active-subway { background: #008938; color: white; border-color: #008938; }
        .filter-btn.active-hj { background: #D71920; color: white; border-color: #D71920; }
        .filter-btn.active-feature { background: var(--gold); color: white; border-color: var(--gold); }

        #loo-details { display: none; }
        .tier-label { font-family: 'Cinzel', serif; font-weight: bold; font-size: 0.8rem; color: var(--gold); text-transform: uppercase; margin-bottom: 8px; display: block; letter-spacing: 1.5px;}
        .tags-container { display: flex; flex-wrap: wrap; gap: 5px; margin: 15px 0; }
        .tag { padding: 6px 10px; background: rgba(226, 206, 173, 0.3); border: 1px solid var(--border); border-radius: 8px; font-size: 0.8rem; font-family: 'Cinzel', serif; display: flex; align-items: center; gap: 5px; }
        .scripture { font-style: italic; color: var(--gold); margin: 20px 0; border-left: 4px solid var(--gold); padding-left: 15px; font-size: 1rem; line-height: 1.5; }
        .btn-action { background: var(--red); color: white; border: none; padding: 16px; border-radius: 12px; font-family: 'Cinzel', serif; font-weight: bold; width: 100%; margin-top: 12px; cursor: pointer; font-size: 1rem; box-shadow: 0 4px 0 #601a25; }
        .btn-back { background: transparent; border: 1px solid var(--text); color: var(--text); padding: 10px; border-radius: 12px; cursor: pointer; margin-bottom: 20px; font-family: 'Nunito'; font-weight: bold; transition: background 0.2s; }
        .btn-back:hover { background: rgba(0,0,0,0.05); }

        /* --- RIGHT COLUMN: MAP --- */
        #map { height: 100%; width: 100%; border-radius: 30px; }
        .map-ctrl { position: absolute; right: 20px; bottom: 20px; z-index: 100; display: flex; flex-direction: column; gap: 10px; }
        .ctrl-btn { background: white; border: 2px solid var(--border); width: 45px; height: 45px; border-radius: 50%; cursor: pointer; font-size: 1.2rem; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(0,0,0,0.1); transition: transform 0.1s; }

        /* --- MOBILE --- */
        @media (max-width: 800px) {
            .bento-wrapper { grid-template-columns: 1fr; grid-template-rows: auto 1fr; gap: 15px; padding: 15px; height: 100vh; }
            .sidebar { padding: 20px; max-height: 45vh; }
            .logo-small { font-size: 1.8rem; margin-bottom: 10px; padding-bottom: 10px; }
            #splash h1 { font-size: 3.5rem; }
            .majestic-poo { font-size: 5rem; }
        }
    </style>
</head>
<body>

    <div id="splash">
        <div class="divine-glow"></div>
        <div class="majestic-poo">üí©</div>
        <h1>HolyShit</h1>
        <p>Seek Sanctuary. Find Deliverance.</p>
        <button class="btn-enter" onclick="dismissSplash()">Enter the Gates</button>
    </div>

    <div class="bento-wrapper">
        
        <div class="bento-card sidebar">
            <h1 class="logo-small" onclick="resetSidebar()">HolyShit</h1>
            
            <div id="default-menu">
                <p>We have mapped over 25,000 public restrooms across Australia, including the most reliable fast-food sanctuaries.</p>
                
                <div class="filter-section">
                    <h3>Brand Sanctuaries</h3>
                    <div class="filter-grid">
                        <button class="filter-btn" id="btn-maccas" onclick="toggleFilter('maccas')">üçî McDonald's</button>
                        <button class="filter-btn" id="btn-kfc" onclick="toggleFilter('kfc')">üçó KFC</button>
                        <button class="filter-btn" id="btn-subway" onclick="toggleFilter('subway')">ü•™ Subway</button>
                        <button class="filter-btn" id="btn-hj" onclick="toggleFilter('hj')">üçî Hungry Jack's</button>
                    </div>
                </div>

                <div class="filter-section">
                    <h3>Holy Features</h3>
                    <div class="filter-grid">
                        <button class="filter-btn" id="btn-access" onclick="toggleFilter('access')">‚ôø Accessible</button>
                        <button class="filter-btn" id="btn-baby" onclick="toggleFilter('baby')">üçº Baby Change</button>
                        <button class="filter-btn" id="btn-unisex" onclick="toggleFilter('unisex')">‚ößÔ∏è All Gender</button>
                        <button class="filter-btn" id="btn-open24" onclick="toggleFilter('open24')">üïí 24/7 Access</button>
                    </div>
                </div>

                <p class="gospel-quote">"Never wander the wilderness again."</p>
            </div>

            <div id="loo-details">
                <button class="btn-back" onclick="resetSidebar()">‚Üê Back to Dashboard</button>
                <span id="loo-tier" class="tier-label">House of Relief</span>
                <h2 id="loo-name" style="font-family: 'Cinzel', serif; margin: 0 0 5px 0; font-size: 1.6rem;">Sanctuary</h2>
                <p id="loo-address" style="color: #666; font-size: 0.95rem; margin: 0;"></p>
                
                <div id="loo-tags" class="tags-container"></div>
                
                <div class="scripture" id="loo-scripture"></div>
                
                <button class="btn-action" onclick="openDirections()">Navigate to Peace</button>
                <button class="btn-action" style="background: var(--gold); box-shadow: 0 4px 0 #8c6316;" onclick="openStreetView()">Behold the Entrance</button>
            </div>
        </div>

        <div class="bento-card">
            <div id="map"></div>
            <div class="map-ctrl">
                <button class="ctrl-btn" onclick="toggleMapType()" title="Satellite View">üõ∞Ô∏è</button>
                <button class="ctrl-btn" onclick="geolocate()" title="Find Me">üìç</button>
            </div>
        </div>

    </div>

    <script>
        let map, currentLoo, markers = [], allLoos = [];
        
        // Filter State (Added Unisex & 24/7)
        let filters = { maccas: false, kfc: false, subway: false, hj: false, baby: false, access: false, unisex: false, open24: false };

        const BRANDS = {
            maccas: { name: "McDonald's", icon: "https://www.google.com/s2/favicons?domain=mcdonalds.com.au&sz=64", color: "#FFC72C", quote: "The Golden Arches provide sanctuary." },
            kfc: { name: "KFC", icon: "https://www.google.com/s2/favicons?domain=kfc.com.au&sz=64", color: "#E50027", quote: "Finger lickin' relief." },
            subway: { name: "Subway", icon: "https://www.google.com/s2/favicons?domain=subway.com.au&sz=64", color: "#008938", quote: "Eat fresh. Rest easy." },
            hj: { name: "Hungry Jack's", icon: "https://www.google.com/s2/favicons?domain=hungryjacks.com.au&sz=64", color: "#D71920", quote: "The burgers are better, and so is the bathroom." },
            public: { name: "House of Relief", icon: null, color: "#8B2635", quote: "A humble, public sanctuary." }
        };

        function detectBrand(name) {
            if (!name) return 'public';
            const n = name.toLowerCase();
            if (n.includes('mcdonald') || n.includes('maccas')) return 'maccas';
            if (n.includes('kfc') || n.includes('kentucky fried')) return 'kfc';
            if (n.includes('subway')) return 'subway';
            if (n.includes('hungry jack')) return 'hj';
            return 'public';
        }

        function dismissSplash() {
            const splash = document.getElementById('splash');
            splash.style.opacity = '0';
            setTimeout(() => { splash.style.display = 'none'; }, 800);
        }

        function resetSidebar() {
            document.getElementById('loo-details').style.display = 'none';
            document.getElementById('default-menu').style.display = 'block';
            document.querySelector('.sidebar').style.borderTop = "none";
        }

        function toggleFilter(type) {
            filters[type] = !filters[type]; 
            const btn = document.getElementById('btn-' + type);
            if (['maccas', 'kfc', 'subway', 'hj'].includes(type)) {
                btn.classList.toggle('active-' + type);
            } else {
                btn.classList.toggle('active-feature');
            }
            renderVisibleMarkers(); 
        }

        async function initMap() {
            map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: -35.2809, lng: 149.1300 }, 
                zoom: 14,
                disableDefaultUI: true,
                styles: [{ featureType: "poi.business", stylers: [{ visibility: "off" }] }]
            });

            map.addListener("click", resetSidebar);
            map.addListener("idle", renderVisibleMarkers);
            geolocate();
            loadData();
        }

        function geolocate() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(pos => {
                    map.panTo({ lat: pos.coords.latitude, lng: pos.coords.longitude });
                });
            }
        }

        function toggleMapType() {
            const current = map.getMapTypeId();
            map.setMapTypeId(current === 'roadmap' ? 'satellite' : 'roadmap');
        }

        async function loadData() {
            try {
                const response = await fetch('toilets-au.json');
                allLoos = await response.json();
                
                allLoos.forEach(loo => { loo.brand = detectBrand(loo.n); });
                renderVisibleMarkers();
            } catch (e) { console.error("Data load failed", e); }
        }

        function renderVisibleMarkers() {
            if (!map) return;
            const bounds = map.getBounds();
            if (!bounds) return;

            markers.forEach(m => m.setMap(null));
            markers = [];

            const brandFilterActive = filters.maccas || filters.kfc || filters.subway || filters.hj;

            let visible = allLoos.filter(loo => {
                if (!bounds.contains({lat: loo.lat, lng: loo.lon})) return false;

                if (brandFilterActive) {
                    if (loo.brand === 'public') return false; 
                    if (!filters[loo.brand]) return false;    
                }

                // Apply Deep Feature Filters
                if (!loo.t) return false; // Skip if no tags at all
                if (filters.baby && !loo.t.b) return false;
                if (filters.access && !loo.t.w) return false;
                if (filters.unisex && !loo.t.u) return false;
                
                // Check if 24/7 filter is active and the string contains "24"
                if (filters.open24 && (!loo.t.o || !loo.t.o.includes('24'))) return false;

                return true;
            });
            
            visible.slice(0, 80).forEach(loo => {
                let iconConfig;
                if (loo.brand !== 'public') {
                    iconConfig = { url: BRANDS[loo.brand].icon, scaledSize: new google.maps.Size(32, 32), anchor: new google.maps.Point(16, 16) };
                } else {
                    iconConfig = {
                        url: `data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32"><text x="0" y="24" font-size="28">üí©</text></svg>`,
                        anchor: new google.maps.Point(16, 24)
                    };
                }

                const marker = new google.maps.Marker({
                    position: { lat: loo.lat, lng: loo.lon },
                    map: map,
                    icon: iconConfig
                });
                
                marker.addListener("click", () => populateSidebar(loo));
                markers.push(marker);
            });
        }

        function populateSidebar(loo) {
            currentLoo = loo;
            document.getElementById('default-menu').style.display = 'none';
            document.getElementById('loo-details').style.display = 'block';

            const brandData = BRANDS[loo.brand];

            document.getElementById('loo-name').innerText = loo.n || brandData.name;
            document.getElementById('loo-address').innerText = loo.a;
            document.getElementById('loo-tier').innerText = brandData.name;
            document.querySelector('.sidebar').style.borderTop = `8px solid ${brandData.color}`;
            
            // THE TAG DECODER: Turning JSON letters into beautiful UI
            const tags = document.getElementById('loo-tags');
            tags.innerHTML = '';
            
            if (loo.t) {
                if (loo.t.w) tags.innerHTML += '<span class="tag">‚ôø Accessible</span>';
                if (loo.t.b) tags.innerHTML += '<span class="tag">üçº Baby Change</span>';
                if (loo.t.u) tags.innerHTML += '<span class="tag">‚ößÔ∏è All Gender</span>';
                if (loo.t.f && !loo.t.u) tags.innerHTML += '<span class="tag">üö∫ Female</span>';
                if (loo.t.m && !loo.t.u) tags.innerHTML += '<span class="tag">üöπ Male</span>';
                if (loo.t.d) tags.innerHTML += '<span class="tag">üíß Water / Wash</span>';
                if (loo.t.o) tags.innerHTML += `<span class="tag" style="background: rgba(184, 132, 30, 0.2); border-color: var(--gold);">üïí ${loo.t.o}</span>`;
            }
            
            document.getElementById('loo-scripture').innerText = loo.note || brandData.quote;
        }

        function openDirections() { window.open(`https://www.google.com/maps/dir/?api=1&destination=${currentLoo.lat},${currentLoo.lon}`); }
        function openStreetView() { window.open(`https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=${currentLoo.lat},${currentLoo.lon}`); }
    </script>
    

  
 <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyByuYcj_qjTbjC2sRWx8VmlMLMxELQ3fB8&callback=initMap" async defer></script>
</body>
</html>
    

  
