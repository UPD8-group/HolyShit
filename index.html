<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>HolyShit.app ‚Äî Seek Sanctuary</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üí©</text></svg>">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#EAE6DF">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=Cinzel:wght@400;700&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #EAE6DF; 
            --card-bg: #FDF6E8;
            --border: #E2CEAD;
            --text: #2A1A0A;
            --gold: #B8841E;
            --red: #8B2635;
        }
        
        body, html { margin: 0; padding: 0; height: 100%; font-family: 'Nunito', sans-serif; background: var(--bg-color); overflow: hidden; }

        /* --- THE DIVINE SPLASH PAGE --- */
        #splash {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; 
            background: radial-gradient(circle at center, #FFFDF0 0%, #E2CEAD 100%);
            z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center;
            text-align: center; padding: 20px; box-sizing: border-box; transition: opacity 0.8s ease;
            overflow: hidden;
        }

        .divine-glow {
            position: absolute; width: 300px; height: 300px;
            background: radial-gradient(circle, rgba(255, 215, 0, 0.4) 0%, rgba(255,255,255,0) 70%);
            border-radius: 50%; z-index: 1; animation: pulse-glow 4s infinite alternate;
        }

        @keyframes pulse-glow {
            0% { transform: scale(1); opacity: 0.6; box-shadow: 0 0 50px rgba(255, 215, 0, 0.4); }
            100% { transform: scale(1.6); opacity: 1; box-shadow: 0 0 150px rgba(255, 255, 255, 0.8), 0 0 200px rgba(255, 215, 0, 0.6); }
        }

        .majestic-poo {
            font-size: 7rem; z-index: 2; filter: drop-shadow(0 15px 15px rgba(0,0,0,0.2));
            animation: float 3.5s ease-in-out infinite; margin-bottom: 10px;
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
            100% { transform: translateY(0px); }
        }

        #splash h1 { font-family: 'Cinzel Decorative', cursive; font-size: 4.5rem; color: var(--red); margin: 0; text-shadow: 3px 3px var(--border); z-index: 2; position: relative; }
        #splash p { font-family: 'Cinzel', serif; font-size: 1.2rem; color: var(--gold); margin: 15px 0 40px; font-weight: bold; letter-spacing: 1px; z-index: 2; position: relative; }
        .btn-enter { position: relative; z-index: 2; background: var(--red); color: white; border: none; padding: 20px 50px; border-radius: 40px; font-family: 'Cinzel', serif; font-size: 1.3rem; font-weight: bold; cursor: pointer; box-shadow: 0 6px 0 #601a25; transition: all 0.1s; }
        .btn-enter:active { transform: translateY(4px); box-shadow: 0 2px 0 #601a25; }

        /* --- BENTO BOX LAYOUT --- */
        .bento-wrapper {
            display: grid; grid-template-columns: 350px 1fr; gap: 20px; padding: 20px;
            height: 100vh; box-sizing: border-box; max-width: 1600px; margin: 0 auto;
        }
        .bento-card {
            background: var(--card-bg); border-radius: 30px; box-shadow: 0 8px 25px rgba(0,0,0,0.06);
            border: 1px solid var(--border); overflow: hidden; position: relative;
        }

        /* --- THE DASHBOARD (Left Column) --- */
        .sidebar { padding: 30px; display: flex; flex-direction: column; overflow-y: auto; }
        .logo-small { font-family: 'Cinzel Decorative', cursive; font-size: 2.2rem; color: var(--red); margin: 0 0 20px 0; text-shadow: 1px 1px 0px var(--border); cursor: pointer; border-bottom: 2px solid var(--border); padding-bottom: 15px; }
        
        #default-menu p { font-size: 1.05rem; line-height: 1.6; color: var(--text); }
        .gospel-quote { color: var(--gold); font-style: italic; font-family: 'Cinzel', serif; text-align: center; margin-top: 20px; font-size: 1.1rem; }
        
        /* Dashboard Filters */
        .filter-section { margin-top: 25px; border-top: 1px solid var(--border); padding-top: 20px; }
        .filter-section h3 { font-family: 'Cinzel', serif; color: var(--gold); font-size: 1rem; margin-top: 0; text-transform: uppercase; letter-spacing: 1px; }
        .filter-grid { display: flex; flex-wrap: wrap; gap: 10px; }
        .filter-btn { background: white; border: 1px solid var(--border); padding: 10px 15px; border-radius: 20px; font-family: 'Nunito', sans-serif; font-weight: bold; color: var(--text); cursor: pointer; transition: all 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .filter-btn.active { background: var(--gold); color: white; border-color: var(--gold); box-shadow: 0 4px 10px rgba(184, 132, 30, 0.3); transform: translateY(-2px); }

        #loo-details { display: none; }
        .tier-label { font-family: 'Cinzel', serif; font-weight: bold; font-size: 0.8rem; color: var(--gold); text-transform: uppercase; margin-bottom: 8px; display: block; letter-spacing: 1.5px;}
        .tag { display: inline-block; padding: 6px 12px; background: rgba(226, 206, 173, 0.3); border: 1px solid var(--border); border-radius: 8px; font-size: 0.8rem; margin: 4px 4px 4px 0; font-family: 'Cinzel', serif; }
        .scripture { font-style: italic; color: var(--gold); margin: 20px 0; border-left: 4px solid var(--gold); padding-left: 15px; font-size: 1rem; line-height: 1.5; }
        .btn-action { background: var(--red); color: white; border: none; padding: 16px; border-radius: 12px; font-family: 'Cinzel', serif; font-weight: bold; width: 100%; margin-top: 12px; cursor: pointer; font-size: 1rem; box-shadow: 0 4px 0 #601a25; }
        .btn-back { background: transparent; border: 1px solid var(--text); color: var(--text); padding: 10px; border-radius: 12px; cursor: pointer; margin-bottom: 20px; font-family: 'Nunito'; font-weight: bold; transition: background 0.2s; }
        .btn-back:hover { background: rgba(0,0,0,0.05); }

        /* --- RIGHT COLUMN: MAP --- */
        #map { height: 100%; width: 100%; border-radius: 30px; }
        .map-ctrl { position: absolute; right: 20px; bottom: 20px; z-index: 100; display: flex; flex-direction: column; gap: 10px; }
        .ctrl-btn { background: white; border: 2px solid var(--border); width: 45px; height: 45px; border-radius: 50%; cursor: pointer; font-size: 1.2rem; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(0,0,0,0.1); transition: transform 0.1s; }
        .ctrl-btn:active { transform: scale(0.95); }

        /* --- MOBILE --- */
        @media (max-width: 800px) {
            .bento-wrapper { grid-template-columns: 1fr; grid-template-rows: auto 1fr; gap: 15px; padding: 15px; height: 100vh; }
            .sidebar { padding: 20px; max-height: 40vh; }
            .logo-small { font-size: 1.8rem; margin-bottom: 10px; padding-bottom: 10px; }
            #splash h1 { font-size: 3.5rem; }
            .majestic-poo { font-size: 5rem; }
            .filter-grid { flex-wrap: nowrap; overflow-x: auto; padding-bottom: 5px; }
            .filter-btn { flex-shrink: 0; }
        }
    </style>
</head>
<body>

    <div id="splash">
        <div class="divine-glow"></div>
        <div class="majestic-poo">üí©</div>
        <h1>HolyShit</h1>
        <p>Seek Sanctuary. Find Deliverance.</p>
        <button class="btn-enter" onclick="dismissSplash()">Enter the Gates</button>
    </div>

    <div class="bento-wrapper">
        
        <div class="bento-card sidebar">
            <h1 class="logo-small" onclick="resetSidebar()">HolyShit</h1>
            
            <div id="default-menu">
                <p>We have mapped over 25,000 public restrooms across Australia, rating them from humble Houses of Relief to glorious <strong>Golden Thrones</strong>.</p>
                
                <div class="filter-section">
                    <h3>Seek Thy Preference</h3>
                    <div class="filter-grid">
                        <button class="filter-btn" id="btn-golden" onclick="toggleFilter('golden')">üëë Golden Thrones</button>
                        <button class="filter-btn" id="btn-baby" onclick="toggleFilter('baby')">üçº Baby Change</button>
                        <button class="filter-btn" id="btn-access" onclick="toggleFilter('access')">‚ôø Accessible</button>
                    </div>
                </div>

                <p class="gospel-quote">"Never wander the wilderness again."</p>
            </div>

            <div id="loo-details">
                <button class="btn-back" onclick="resetSidebar()">‚Üê Back to Dashboard</button>
                <span id="loo-tier" class="tier-label">House of Relief</span>
                <h2 id="loo-name" style="font-family: 'Cinzel', serif; margin: 0 0 5px 0; font-size: 1.6rem;">Sanctuary</h2>
                <p id="loo-address" style="color: #666; font-size: 0.95rem; margin: 0;"></p>
                <div id="loo-tags" style="margin: 15px 0;"></div>
                <div class="scripture" id="loo-scripture"></div>
                
                <button class="btn-action" onclick="openDirections()">Navigate to Peace</button>
                <button class="btn-action" id="btn-streetview" style="background: var(--gold); box-shadow: 0 4px 0 #8c6316;" onclick="openStreetView()">Behold the Entrance</button>
            </div>
        </div>

        <div class="bento-card">
            <div id="map"></div>
            <div class="map-ctrl">
                <button class="ctrl-btn" onclick="toggleMapType()" title="Satellite View">üõ∞Ô∏è</button>
                <button class="ctrl-btn" onclick="geolocate()" title="Find Me">üìç</button>
            </div>
        </div>

    </div>

    <script>
        let map, currentLoo, markers = [], allLoos = [];
        
        // Filter State
        let filters = { golden: false, baby: false, access: false };

        const GOLDEN_THRONES = [
            { id: 'maccas_canberra_centre', n: "McDonald's Canberra Centre", a: "Canberra Centre, Bunda St", lat: -35.2796, lon: 149.1320, t: { w:1, b:1, f:1, o:"24/7" }, golden: true, note: "The First Golden Throne. A sanctuary of convenience." }
        ];

        function dismissSplash() {
            const splash = document.getElementById('splash');
            splash.style.opacity = '0';
            setTimeout(() => { splash.style.display = 'none'; }, 800);
        }

        function resetSidebar() {
            document.getElementById('loo-details').style.display = 'none';
            document.getElementById('default-menu').style.display = 'block';
            document.querySelector('.sidebar').style.borderTop = "none";
        }

        function toggleFilter(type) {
            filters[type] = !filters[type]; // Toggle true/false
            document.getElementById('btn-' + type).classList.toggle('active'); // Toggle UI button
            renderVisibleMarkers(); // Instantly update the map
        }

        async function initMap() {
            map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: -35.2809, lng: 149.1300 }, 
                zoom: 15,
                disableDefaultUI: true,
                styles: [{ featureType: "poi.business", stylers: [{ visibility: "off" }] }]
            });

            map.addListener("click", resetSidebar);
            map.addListener("idle", renderVisibleMarkers);
            geolocate();
            loadData();
        }

        function geolocate() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(pos => {
                    map.panTo({ lat: pos.coords.latitude, lng: pos.coords.longitude });
                });
            }
        }

        function toggleMapType() {
            const current = map.getMapTypeId();
            map.setMapTypeId(current === 'roadmap' ? 'satellite' : 'roadmap');
        }

        async function loadData() {
            try {
                const response = await fetch('toilets-au.json');
                let govLoos = await response.json();
                
                // THE MACCAS BAPTISM: Automatically upgrade all McDonald's to Golden Thrones
                govLoos = govLoos.map(loo => {
                    if (loo.n && (loo.n.toLowerCase().includes('mcdonald') || loo.n.toLowerCase().includes('maccas'))) {
                        loo.golden = true;
                        loo.note = "A franchised sanctuary. The Golden Arches provide.";
                    }
                    return loo;
                });

                allLoos = [...GOLDEN_THRONES, ...govLoos];
                renderVisibleMarkers();
            } catch (e) { console.error("Data load failed", e); }
        }

        function renderVisibleMarkers() {
            if (!map) return;
            const bounds = map.getBounds();
            if (!bounds) return;

            // Clear old markers
            markers.forEach(m => m.setMap(null));
            markers = [];

            // Find loosely visible loos
            let visible = allLoos.filter(l => bounds.contains({lat: l.lat, lng: l.lon}));
            
            // Apply the Dashboard Filters!
            visible = visible.filter(loo => {
                if (filters.golden && !loo.golden) return false; // Hide if not golden
                if (filters.baby && !loo.t.b) return false;     // Hide if no baby change
                if (filters.access && !loo.t.w) return false;   // Hide if not accessible
                return true;
            });
            
            // Draw up to 80 pins
            visible.slice(0, 80).forEach(loo => {
                const emoji = loo.golden ? "üëë" : "üí©";
                const svgIcon = `data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32"><text x="0" y="24" font-size="28">${emoji}</text></svg>`;

                const marker = new google.maps.Marker({
                    position: { lat: loo.lat, lng: loo.lon },
                    map: map,
                    icon: { url: svgIcon, anchor: new google.maps.Point(16, 24) }
                });
                marker.addListener("click", () => populateSidebar(loo));
                markers.push(marker);
            });
        }

        function populateSidebar(loo) {
            currentLoo = loo;
            document.getElementById('default-menu').style.display = 'none';
            document.getElementById('loo-details').style.display = 'block';

            document.getElementById('loo-name').innerText = loo.n;
            document.getElementById('loo-address').innerText = loo.a;
            document.getElementById('loo-tier').innerText = loo.golden ? "üëë The Golden Throne" : "üí© House of Relief";
            
            const tags = document.getElementById('loo-tags');
            tags.innerHTML = '';
            if (loo.t.w) tags.innerHTML += '<span class="tag">‚ôø Blessed Access</span>';
            if (loo.t.b) tags.innerHTML += '<span class="tag">üçº Baptismal</span>';
            if (loo.t.o) tags.innerHTML += `<span class="tag">üïí ${loo.t.o}</span>`;
            
            const quotes = ["Seek and ye shall find.", "Rest for the weary soul.", "Deliverance is at hand."];
            document.getElementById('loo-scripture').innerText = loo.note || quotes[Math.floor(Math.random()*quotes.length)];

            if (loo.golden) {
                document.querySelector('.sidebar').style.borderTop = "8px solid var(--gold)";
            } else {
                document.querySelector('.sidebar').style.borderTop = "none";
            }
        }

        function openDirections() { window.open(`https://www.google.com/maps/dir/?api=1&destination=${currentLoo.lat},${currentLoo.lon}`); }
        function openStreetView() { window.open(`https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=${currentLoo.lat},${currentLoo.lon}`); }
    </script>
    
   
  
 <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyByuYcj_qjTbjC2sRWx8VmlMLMxELQ3fB8&callback=initMap" async defer></script>
</body>
</html>
    

  
