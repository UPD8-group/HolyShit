<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>HolyShit.app ‚Äî Seek Sanctuary</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#8B2635">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=Cinzel:wght@400;700&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --cream: #FDF6E8; --warm-white: #FFFCF4; --border: #E2CEAD;
            --text: #2A1A0A; --gold: #B8841E; --red: #8B2635; --green: #2E7D4F;
        }
        body, html { margin: 0; padding: 0; height: 100%; font-family: 'Nunito', sans-serif; background: var(--cream); overflow: hidden; }
        #map { height: 100vh; width: 100vw; }
        
        .header { position: absolute; top: env(safe-area-inset-top, 20px); left: 50%; transform: translateX(-50%); z-index: 1000; text-align: center; width: 90%; pointer-events: none; }
        .logo { font-family: 'Cinzel Decorative', cursive; font-size: 2.5rem; color: var(--red); text-shadow: 2px 2px 0px var(--border); margin: 0; pointer-events: auto; cursor: pointer; }

        #sheet {
            position: fixed; bottom: -100%; left: 0; right: 0; background: var(--warm-white);
            border-top: 5px solid var(--gold); border-radius: 24px 24px 0 0;
            transition: bottom 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 2000; padding: 30px 20px 40px; box-shadow: 0 -10px 40px rgba(0,0,0,0.2);
        }
        #sheet.open { bottom: 0; }
        #sheet.golden { border-top-color: #FFD700; background: #FFFDF0; }
        
        .tier-label { font-family: 'Cinzel', serif; font-weight: bold; font-size: 0.75rem; color: var(--gold); text-transform: uppercase; margin-bottom: 8px; display: block; letter-spacing: 1.5px;}
        .btn-action { background: var(--red); color: white; border: none; padding: 16px; border-radius: 12px; font-family: 'Cinzel', serif; font-weight: bold; width: 100%; margin-top: 12px; cursor: pointer; font-size: 1rem; box-shadow: 0 4px 0 #601a25; }
        .tag { display: inline-block; padding: 6px 12px; background: var(--cream); border: 1px solid var(--border); border-radius: 8px; font-size: 0.8rem; margin: 4px; font-family: 'Cinzel', serif; }
        .scripture { font-style: italic; color: var(--gold); margin: 20px 0; border-left: 4px solid var(--gold); padding-left: 15px; font-size: 1rem; line-height: 1.5; }

        .map-ctrl { position: absolute; right: 20px; bottom: 100px; z-index: 1000; display: flex; flex-direction: column; gap: 10px; }
        .ctrl-btn { background: white; border: 2px solid var(--border); width: 50px; height: 50px; border-radius: 50%; cursor: pointer; font-size: 1.5rem; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
    </style>
</head>
<body>

    <div class="header">
        <h1 class="logo" onclick="location.reload()">HolyShit</h1>
    </div>

    <div id="map"></div>

    <div class="map-ctrl">
        <button class="ctrl-btn" onclick="toggleMapType()" title="Satellite View">üõ∞Ô∏è</button>
        <button class="ctrl-btn" onclick="geolocate()" title="Find Me">üìç</button>
    </div>

    <div id="sheet">
        <div id="sheet-content">
            <span id="loo-tier" class="tier-label">House of Relief</span>
            <h2 id="loo-name" style="font-family: 'Cinzel', serif; margin: 0; font-size: 1.8rem;">Sanctuary</h2>
            <p id="loo-address" style="color: #666; font-size: 0.95rem; margin-top: 8px;"></p>
            <div id="loo-tags" style="margin: 15px 0;"></div>
            <div class="scripture" id="loo-scripture"></div>
            
            <button class="btn-action" onclick="openDirections()">Navigate to Peace</button>
            <button class="btn-action" style="background: var(--gold); box-shadow: 0 4px 0 #8c6316;" onclick="openStreetView()">Behold the Entrance</button>
        </div>
    </div>

    <script>
        let map, currentLoo, markers = [], allLoos = [];

        const GOLDEN_THRONES = [
            { id: 'maccas_canberra_centre', n: "McDonald's Canberra Centre", a: "Canberra Centre, Bunda St", lat: -35.2796, lon: 149.1320, t: { w:1, b:1, f:1, o:"24/7" }, golden: true, note: "The First Golden Throne. A sanctuary of convenience." }
        ];

        async function initMap() {
            map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: -35.2809, lng: 149.1300 }, 
                zoom: 16,
                disableDefaultUI: true,
                styles: [{ featureType: "poi.business", stylers: [{ visibility: "off" }] }]
            });

            map.addListener("click", () => document.getElementById('sheet').classList.remove('open'));
            geolocate();
            loadData();
        }

        function geolocate() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(pos => {
                    map.panTo({ lat: pos.coords.latitude, lng: pos.coords.longitude });
                });
            }
        }

        function toggleMapType() {
            const current = map.getMapTypeId();
            map.setMapTypeId(current === 'roadmap' ? 'satellite' : 'roadmap');
        }

        async function loadData() {
            try {
                const response = await fetch('toilets-au.json');
                const govLoos = await response.json();
                allLoos = [...GOLDEN_THRONES, ...govLoos];
                map.addListener("idle", renderVisibleMarkers);
            } catch (e) { console.error("Data load failed", e); }
        }

        function renderVisibleMarkers() {
            const bounds = map.getBounds();
            markers.forEach(m => m.setMap(null));
            markers = [];

            const visible = allLoos.filter(l => bounds.contains({lat: l.lat, lng: l.lon}));
            
            visible.slice(0, 75).forEach(loo => {
                const marker = new google.maps.Marker({
                    position: { lat: loo.lat, lng: loo.lon },
                    map: map,
                    icon: {
                        path: loo.golden ? "M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" : google.maps.SymbolPath.BACKWARD_CLOSED_ARROW,
                        fillColor: loo.golden ? "#FFD700" : "#8B2635",
                        fillOpacity: 1,
                        strokeColor: "#FFFFFF",
                        strokeWeight: 2,
                        scale: loo.golden ? 1.5 : 6
                    }
                });
                marker.addListener("click", () => openSheet(loo));
                markers.push(marker);
            });
        }

        function openSheet(loo) {
            currentLoo = loo;
            document.getElementById('loo-name').innerText = loo.n;
            document.getElementById('loo-address').innerText = loo.a;
            document.getElementById('loo-tier').innerText = loo.golden ? "üëë The Golden Throne" : "‚õ™ House of Relief";
            
            const tags = document.getElementById('loo-tags');
            tags.innerHTML = '';
            if (loo.t.w) tags.innerHTML += '<span class="tag">‚ôø Blessed Access</span>';
            if (loo.t.b) tags.innerHTML += '<span class="tag">üçº Baptismal</span>';
            if (loo.t.o) tags.innerHTML += `<span class="tag">üïí ${loo.t.o}</span>`;
            
            const quotes = ["Seek and ye shall find.", "Rest for the weary soul.", "Deliverance is at hand."];
            document.getElementById('loo-scripture').innerText = loo.note || quotes[Math.floor(Math.random()*quotes.length)];

            document.getElementById('sheet').classList.add('open');
            if (loo.golden) document.getElementById('sheet').classList.add('golden'); 
            else document.getElementById('sheet').classList.remove('golden');
        }

        function openDirections() { window.open(`https://www.google.com/maps/dir/?api=1&destination=${currentLoo.lat},${currentLoo.lon}`); }
        function openStreetView() { window.open(`https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=${currentLoo.lat},${currentLoo.lon}`); }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDFitpvie2eA9NEg8pFuhr7SvsKLzrFvVcE&callback=initMap" async defer></script>
</body>
</html>
