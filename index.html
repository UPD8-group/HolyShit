<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>HolyShit.app ‚Äî Seek Sanctuary</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#FDF6E8">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=Cinzel:wght@400;700&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --cream: #FDF6E8; --warm-white: #FFFCF4; --border: #E2CEAD;
            --text: #2A1A0A; --gold: #B8841E; --red: #8B2635;
        }
        body, html { margin: 0; padding: 0; height: 100%; font-family: 'Nunito', sans-serif; background: var(--cream); overflow: hidden; }
        #map { height: 100vh; width: 100vw; }
        
        /* The Header & Hamburger */
        .header { position: absolute; top: env(safe-area-inset-top, 20px); width: 100%; display: flex; justify-content: center; align-items: center; z-index: 1000; pointer-events: none; }
        .logo { font-family: 'Cinzel Decorative', cursive; font-size: 2.2rem; color: var(--red); text-shadow: 2px 2px 0px var(--border); margin: 0; pointer-events: auto; cursor: pointer; }
        .menu-btn { position: absolute; left: 20px; font-size: 2rem; background: none; border: none; color: var(--red); cursor: pointer; pointer-events: auto; text-shadow: 2px 2px 0px white; }

        /* The Splash Page */
        #splash {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: var(--cream);
            z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center;
            text-align: center; padding: 20px; box-sizing: border-box; transition: opacity 0.5s ease;
        }
        #splash h1 { font-family: 'Cinzel Decorative', cursive; font-size: 4rem; color: var(--red); margin: 0; text-shadow: 3px 3px var(--border); }
        #splash p { font-family: 'Cinzel', serif; font-size: 1.2rem; color: var(--gold); margin: 15px 0 50px; }
        .btn-enter { background: var(--red); color: white; border: none; padding: 20px 40px; border-radius: 40px; font-family: 'Cinzel', serif; font-size: 1.3rem; font-weight: bold; cursor: pointer; box-shadow: 0 6px 0 #601a25; transition: all 0.1s; }
        .btn-enter:active { transform: translateY(4px); box-shadow: 0 2px 0 #601a25; }

        /* The Sidebar Menu */
        #sidebar {
            position: fixed; top: 0; left: -320px; width: 300px; height: 100vh; background: var(--warm-white);
            z-index: 3000; box-shadow: 5px 0 25px rgba(0,0,0,0.2); transition: left 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.1);
            padding: 40px 25px; box-sizing: border-box;
        }
        #sidebar.open { left: 0; }
        .close-btn { position: absolute; top: 20px; right: 20px; font-size: 2rem; background: none; border: none; cursor: pointer; color: var(--text); }
        .sidebar-content h2 { font-family: 'Cinzel Decorative', cursive; color: var(--red); font-size: 2rem; margin-top: 20px; }
        .sidebar-content p { font-size: 1.05rem; line-height: 1.6; color: var(--text); margin-bottom: 20px; }

        /* The Bottom Sheet */
        #sheet {
            position: fixed; bottom: -100%; left: 0; right: 0; background: var(--warm-white);
            border-top: 5px solid var(--gold); border-radius: 24px 24px 0 0;
            transition: bottom 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 2000; padding: 30px 20px 40px; box-shadow: 0 -10px 40px rgba(0,0,0,0.2);
        }
        #sheet.open { bottom: 0; }
        #sheet.golden { border-top-color: #FFD700; background: #FFFDF0; }
        
        .tier-label { font-family: 'Cinzel', serif; font-weight: bold; font-size: 0.75rem; color: var(--gold); text-transform: uppercase; margin-bottom: 8px; display: block; letter-spacing: 1.5px;}
        .btn-action { background: var(--red); color: white; border: none; padding: 16px; border-radius: 12px; font-family: 'Cinzel', serif; font-weight: bold; width: 100%; margin-top: 12px; cursor: pointer; font-size: 1rem; box-shadow: 0 4px 0 #601a25; }
        .tag { display: inline-block; padding: 6px 12px; background: var(--cream); border: 1px solid var(--border); border-radius: 8px; font-size: 0.8rem; margin: 4px; font-family: 'Cinzel', serif; }
        .scripture { font-style: italic; color: var(--gold); margin: 20px 0; border-left: 4px solid var(--gold); padding-left: 15px; font-size: 1rem; line-height: 1.5; }

        /* Map Controls */
        .map-ctrl { position: absolute; right: 20px; bottom: 100px; z-index: 1000; display: flex; flex-direction: column; gap: 10px; }
        .ctrl-btn { background: white; border: 2px solid var(--border); width: 50px; height: 50px; border-radius: 50%; cursor: pointer; font-size: 1.5rem; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
    </style>
</head>
<body>

    <div id="splash">
        <h1>HolyShit</h1>
        <p>Seek Sanctuary. Find Deliverance.</p>
        <button class="btn-enter" onclick="dismissSplash()">Enter the Gates</button>
    </div>

    <div id="sidebar">
        <button class="close-btn" onclick="toggleSidebar()">√ó</button>
        <div class="sidebar-content">
            <h2>The Gospel</h2>
            <p><strong>HolyShit</strong> is your divine guide to finding a sanctuary when you need it most.</p>
            <p>We have mapped over 25,000 public restrooms across Australia, rating them from humble Houses of Relief to glorious <strong>Golden Thrones</strong>.</p>
            <p style="color: var(--gold); font-style: italic; font-family: 'Cinzel', serif; text-align: center; margin-top: 40px;">"Never wander the wilderness again."</p>
        </div>
    </div>

    <div class="header">
        <button class="menu-btn" onclick="toggleSidebar()">‚ò∞</button>
        <h1 class="logo" onclick="location.reload()">HolyShit</h1>
    </div>

    <div id="map"></div>

    <div class="map-ctrl">
        <button class="ctrl-btn" onclick="toggleMapType()" title="Satellite View">üõ∞Ô∏è</button>
        <button class="ctrl-btn" onclick="geolocate()" title="Find Me">üìç</button>
    </div>

    <div id="sheet">
        <div id="sheet-content">
            <span id="loo-tier" class="tier-label">House of Relief</span>
            <h2 id="loo-name" style="font-family: 'Cinzel', serif; margin: 0; font-size: 1.8rem;">Sanctuary</h2>
            <p id="loo-address" style="color: #666; font-size: 0.95rem; margin-top: 8px;"></p>
            <div id="loo-tags" style="margin: 15px 0;"></div>
            <div class="scripture" id="loo-scripture"></div>
            
            <button class="btn-action" onclick="openDirections()">Navigate to Peace</button>
            <button class="btn-action" style="background: var(--gold); box-shadow: 0 4px 0 #8c6316;" onclick="openStreetView()">Behold the Entrance</button>
        </div>
    </div>

    <script>
        let map, currentLoo, markers = [], allLoos = [];

        const GOLDEN_THRONES = [
            { id: 'maccas_canberra_centre', n: "McDonald's Canberra Centre", a: "Canberra Centre, Bunda St", lat: -35.2796, lon: 149.1320, t: { w:1, b:1, f:1, o:"24/7" }, golden: true, note: "The First Golden Throne. A sanctuary of convenience." }
        ];

        // UI Functions
        function dismissSplash() {
            const splash = document.getElementById('splash');
            splash.style.opacity = '0';
            setTimeout(() => splash.style.display = 'none', 500); // Wait for fade
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
        }

        // Map Functions
        async function initMap() {
            map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: -35.2809, lng: 149.1300 }, 
                zoom: 15,
                disableDefaultUI: true,
                styles: [{ featureType: "poi.business", stylers: [{ visibility: "off" }] }]
            });

            // Close sheet or sidebar if map is clicked
            map.addListener("click", () => {
                document.getElementById('sheet').classList.remove('open');
                document.getElementById('sidebar').classList.remove('open');
            });

            geolocate();
            loadData();
        }

        function geolocate() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(pos => {
                    map.panTo({ lat: pos.coords.latitude, lng: pos.coords.longitude });
                });
            }
        }

        function toggleMapType() {
            const current = map.getMapTypeId();
            map.setMapTypeId(current === 'roadmap' ? 'satellite' : 'roadmap');
        }

        async function loadData() {
            try {
                const response = await fetch('toilets-au.json');
                const govLoos = await response.json();
                allLoos = [...GOLDEN_THRONES, ...govLoos];
                map.addListener("idle", renderVisibleMarkers);
            } catch (e) { console.error("Data load failed", e); }
        }

        function renderVisibleMarkers() {
            const bounds = map.getBounds();
            markers.forEach(m => m.setMap(null));
            markers = [];

            const visible = allLoos.filter(l => bounds.contains({lat: l.lat, lng: l.lon}));
            
            // Render up to 75 visible pins to keep the map fast
            visible.slice(0, 75).forEach(loo => {
                // The Emoji Magic happens here
                const emoji = loo.golden ? "üëë" : "üí©";
                const svgIcon = `data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32"><text x="0" y="24" font-size="28">${emoji}</text></svg>`;

                const marker = new google.maps.Marker({
                    position: { lat: loo.lat, lng: loo.lon },
                    map: map,
                    icon: {
                        url: svgIcon,
                        anchor: new google.maps.Point(16, 24)
                    }
                });
                marker.addListener("click", () => openSheet(loo));
                markers.push(marker);
            });
        }

        function openSheet(loo) {
            currentLoo = loo;
            document.getElementById('loo-name').innerText = loo.n;
            document.getElementById('loo-address').innerText = loo.a;
            document.getElementById('loo-tier').innerText = loo.golden ? "üëë The Golden Throne" : "üí© House of Relief";
            
            const tags = document.getElementById('loo-tags');
            tags.innerHTML = '';
            if (loo.t.w) tags.innerHTML += '<span class="tag">‚ôø Blessed Access</span>';
            if (loo.t.b) tags.innerHTML += '<span class="tag">üçº Baptismal</span>';
            if (loo.t.o) tags.innerHTML += `<span class="tag">üïí ${loo.t.o}</span>`;
            
            const quotes = ["Seek and ye shall find.", "Rest for the weary soul.", "Deliverance is at hand."];
            document.getElementById('loo-scripture').innerText = loo.note || quotes[Math.floor(Math.random()*quotes.length)];

            document.getElementById('sheet').classList.add('open');
            if (loo.golden) document.getElementById('sheet').classList.add('golden'); 
            else document.getElementById('sheet').classList.remove('golden');
        }

        function openDirections() { window.open(`https://www.google.com/maps/dir/?api=1&destination=${currentLoo.lat},${currentLoo.lon}`); }
        function openStreetView() { window.open(`https://www.google.com/maps/@?api=1&map_action=pano&viewpoint=${currentLoo.lat},${currentLoo.lon}`); }
    </script>
    
 <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyByuYcj_qjTbjC2sRWx8VmlMLMxELQ3fB8&callback=initMap" async defer></script>
</body>
</html>
  
